<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Riesgo</title>

  <!-- Íconos -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <!-- Estilos propios (opcional) -->
  <link rel="stylesheet" href="./style.css" />

  <!-- Sentry (CDN loader) -->
  <script src="https://js.sentry-cdn.com/9f73ebcd503ecdb650d346e03e56bc14.min.js" crossorigin="anonymous"></script>
  <script>
    Sentry.onLoad(function () {
      const env =
        (location.hostname === 'localhost' || location.hostname.startsWith('127.'))
          ? 'development'
          : 'production';

      Sentry.init({
        dsn: 'https://9f73ebcd503ecdb650d346e03e56bc14@o4507908867162112.ingest.us.sentry.io/4509968922247168',
        enabled: true,
        environment: env,
        release: 'calc-riesgo@1.0.0',
        
        // Configuración simplificada
        tracesSampleRate: 0.0, // Desactivamos tracing por ahora
        integrations: [
          new Sentry.BrowserTracing() // Solo esta integración básica
        ],
        
        // Habilita logs básicos
        enableLogs: true
      });

      // Tags globales
      Sentry.setTag('app', 'calc-riesgo');
      Sentry.setTag('module', 'ui');

      // Log de prueba simple
      Sentry.captureMessage('[Riesgo] App iniciada', {
        level: 'error'
      });
    });
  </script>

  <!-- Sentry SDK -->
<script src="https://browser.sentry-cdn.com/7.64.0/bundle.min.js" crossorigin="anonymous"></script>

<script>
  // Inicialización básica de Sentry
  Sentry.init({
    dsn: "https://9f73ebcd503ecdb650d346e03e56bc14@o4507908867162112.ingest.us.sentry.io/4509968922247168",
    
    // Configuración mínima
    debug: true,
    environment: 'production',
    
    // Deshabilitar características que causan errores
    tracesSampleRate: 0,
    integrations: [],
    
    beforeSend(event) {
      console.log('Enviando evento a Sentry:', event);
      return event;
    }
  });

  // Enviar un evento de prueba inmediatamente
  try {
    throw new Error('Test Error');
  } catch (error) {
    Sentry.captureException(error);
  }

  // También enviar un mensaje de log
  Sentry.captureMessage('Aplicación iniciada', 'info');
</script>

  <style>
    /* Unos estilos mínimos por si no cargas style.css */
    :root {
      --bg: #0f172a; --card: #0b1023; --text:#e6edf3; --muted:#9aa4b2;
      --primary:#7c3aed; --primary-2:#5b21b6;
      --c-marginal:#f8fafc; --c-aceptable:#fef08a; --c-importante:#fecaca; --c-muygrave:#f87171;
    }
    html, body { height:100% }
    body {
      margin:0; background:linear-gradient(180deg, #0b1023, #0f172a 30%, #0b1023 100%); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .app-header { position:sticky; top:0; z-index:5; padding:14px 18px; border-bottom:1px solid #1f2741;
      background:linear-gradient(90deg, rgba(124,58,237,.25), rgba(16,185,129,.15));
      backdrop-filter: blur(10px);
    }
    .brand { display:flex; gap:10px; align-items:center; font-weight:900 }
    .brand .logo { width:36px; height:36px; display:grid; place-items:center; border-radius:10px;
      background:radial-gradient(circle at 30% 30%, #10b981, #0ea5e9); color:#fff; }
    .container { max-width:1100px; margin:20px auto; padding:0 16px }
    .panel { background:rgba(255,255,255,.02); border:1px solid #1f2741; border-radius:14px; padding:18px; margin-bottom:18px }
    .panel h2 { margin:0 0 12px; font-size:18px; font-weight:800 }
    .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:12px }
    .field { margin-bottom:12px }
    .field label { display:block; margin-bottom:6px; color:#cbd5e1; font-weight:800; text-transform:uppercase }
    textarea, select { width:100%; padding:12px; border-radius:10px; border:1px solid #1f2741; background:#0b1023; color:var(--text) }
    textarea:focus, select:focus { border-color:#2563eb; outline:none; box-shadow:0 0 0 3px rgba(37,99,235,.25) }
    .muted { color:var(--muted); font-size:12px }
    .actions { display:flex; gap:10px; align-items:center; margin-top:8px }
    .btn { border:0; padding:12px 16px; border-radius:10px; color:var(--text); background:#1f2741; font-weight:800; cursor:pointer }
    .btn.primary { background:linear-gradient(180deg, var(--primary), var(--primary-2)) }
    .btn.error { background:linear-gradient(180deg, #ef4444, #b91c1c) }
    .btn:disabled { opacity:.6; cursor:not-allowed }

    .resultado { display:flex; gap:14px; align-items:center; border:1px solid #293152; border-radius:12px; padding:13px; margin-top:10px;
      background:rgba(255,255,255,.02); }
    .resultado-badge { display:flex; gap:8px; align-items:center; padding:8px 12px; border-radius:1000px; border:1px solid #1f2741; background:#0b1023; font-weight:900 }

    .tabla-wrap { overflow:auto; border-radius:12px; border:1px solid #1f2741 }
    table { width:100%; border-collapse:separate; border-spacing:0; background:#0b1023 }
    th, td { border-right:1px solid #1f2741; border-bottom:1px solid #1f2741; text-align:center; padding:0 }
    th { background:#11183a; color:#e6edf3; padding:10px; text-transform:uppercase }
    td .cell { padding:16px 0; font-weight:900; color:#111 }
    .marginal{background:var(--c-marginal)} .aceptable{background:var(--c-aceptable)}
    .importante{background:var(--c-importante)} .muygrave{background:var(--c-muygrave)}
    td .cell.selected{ transform:scale(1.04); border-radius:8px; box-shadow:0 0 0 3px #000, 0 8px 18px rgba(0,0,0,.35) }
  </style>
</head>

<body>
  <header class="app-header">
    <div class="brand">
      <div class="logo"><i class="bi bi-shield-lock-fill"></i></div>
      <div>Calculadora de Riesgo de Vulnerabilidades</div>
    </div>
  </header>

  <main class="container">
    <section class="panel">
      <h2><i class="bi bi-clipboard2-check"></i> Evaluación de Riesgo</h2>

      <div class="field">
        <label for="descripcion"><i class="bi bi-journal-text"></i> Describe el riesgo (opcional)</label>
        <textarea id="descripcion" rows="3" placeholder="Ej.: Exposición de credenciales en repositorio público..."></textarea>
        <small id="descContador" class="muted">0/300</small>
      </div>

      <div class="grid-2">
        <div class="field">
          <label for="aparicion"><i class="bi bi-bullseye"></i> Aparición (Probabilidad) *</label>
          <select id="aparicion"><option value="">Cargando niveles...</option></select>
        </div>
        <div class="field">
          <label for="gravedad"><i class="bi bi-lightning-charge"></i> Gravedad (Impacto) *</label>
          <select id="gravedad"><option value="">Cargando niveles...</option></select>
        </div>
      </div>

      <div class="actions">
        <button id="btnCalcular" class="btn primary"><i class="bi bi-rocket-takeoff"></i> Calcular</button>
        <button id="btnLimpiar" class="btn"><i class="bi bi-eraser"></i> Limpiar</button>
      </div>

      <div id="resultado" class="resultado" hidden>
        <div class="resultado-badge">
          <i id="resultadoIcono" class="bi"></i>
          <span id="resultadoNivel">—</span>
        </div>
        <div class="resultado-info">
          <div><strong>Valor de Riesgo:</strong> <span id="resultadoValor">—</span></div>
          <div id="resultadoRecom" class="muted">—</div>
        </div>
      </div>
    </section>

    <section class="panel">
      <h2><i class="bi bi-grid-3x3-gap-fill"></i> Matriz de Evaluación</h2>
      <div class="tabla-wrap">
        <table id="tablaMatriz"></table>
      </div>

      <div class="actions" style="margin-top:12px">
        <button id="btnErrorSentry" class="btn error">
          <i class="bi bi-bug-fill"></i> Enviar error de prueba a Sentry
        </button>
        <small class="muted">No rompe la app; solo envía un evento de error.</small>
      </div>

      <details class="panel" style="margin-top:12px">
        <summary><i class="bi bi-info-circle"></i> Leyenda</summary>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px;margin-top:8px">
          <div class="resultado"><span style="width:16px;height:16px;background:var(--c-marginal);border:2px solid #1f2741;border-radius:4px;margin-right:8px"></span>Riesgo Marginal (1–3)</div>
          <div class="resultado"><span style="width:16px;height:16px;background:var(--c-aceptable);border:2px solid #1f2741;border-radius:4px;margin-right:8px"></span>Riesgo Aceptable (4–8)</div>
          <div class="resultado"><span style="width:16px;height:16px;background:var(--c-importante);border:2px solid #1f2741;border-radius:4px;margin-right:8px"></span>Riesgo Importante (9–16)</div>
          <div class="resultado"><span style="width:16px;height:16px;background:var(--c-muygrave);border:2px solid #1f2741;border-radius:4px;margin-right:8px"></span>Riesgo Muy Grave (17–25)</div>
        </div>
      </details>
    </section>

    <footer class="muted" style="text-align:center;margin:20px 0 8px">
      <i class="bi bi-code-slash"></i> Elaborado por Joan Chavarría Peraza
    </footer>
  </main>

  <!-- Lógica de la app -->
  <script src="./app.js" defer></script>
</body>
</html>