<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora de Riesgo</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="./style.css">

  <!-- Sentry Browser SDK v10 con tracing+replay -->
  <script src="https://browser.sentry-cdn.com/10.9.0/bundle.tracing.replay.min.js" crossorigin="anonymous"></script>

  <script>
    Sentry.onLoad(function () {
      // Detectar entorno
      const env = (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
        ? 'development'
        : 'production';

      // Selecciona automáticamente la integración correcta disponible
      const consoleIntegration =
        (Sentry.consoleLoggingIntegration?.({ levels: ['log', 'warn', 'error'] })) ||
        (Sentry.captureConsoleIntegration?.({ levels: ['log', 'warn', 'error'] })) ||
        (Sentry.consoleIntegration?.({ levels: ['log', 'warn', 'error'] }));

      Sentry.init({
        dsn: "https://9f73ebcd503ecdb650d346e03e56bc14@o4507908867162112.ingest.us.sentry.io/4509968922247168",
        environment: env,
        release: 'calc-riesgo@1.0.0',

        // Habilita Logs (nuevo producto de Sentry) + envía console.log/warn/error como logs
        enableLogs: true,
        integrations: consoleIntegration ? [consoleIntegration] : [],

        // Opcional: ver mensajes de depuración en la consola del navegador
        debug: true,

        // Si usas performance/replay (puedes dejarlos en 0 si no los quieres)
        tracesSampleRate: 0.2,
        replaysSessionSampleRate: 0.0,
        replaysOnErrorSampleRate: 0.0,

        ignoreErrors: [/ResizeObserver loop limit exceeded/i],
        denyUrls: [/extensions\//i, /^chrome:\/\//i],

        beforeSend(event) {
          // No subir ruido de "Script error"
          const msg = event?.message || event?.exception?.values?.[0]?.value || "";
          if (/^Script error\.?$/i.test(msg)) return null;
          return event;
        },
      });

      // Etiquetas útiles
      Sentry.setTag('app', 'calc-riesgo');
      Sentry.setTag('module', 'ui');

      // --- PRUEBAS: dispara dos logs de verificación ---
      console.log('[Riesgo] Log de prueba desde la app', { t: new Date().toISOString() });
      Sentry.captureMessage('[Riesgo] captureMessage con nivel log', 'log');

      // Fuerza el envío inmediato (útil en local)
      const client = Sentry.getCurrentHub()?.getClient?.();
      client?.flush?.(3000);
    });
  </script>
</head>

<body>
  <!-- …tu HTML tal cual… -->
  <script src="./app.js" defer></script>
</body>
</html>
